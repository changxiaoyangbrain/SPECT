# SPECT 大作业分析报告

## 1. 任务概述
本次大作业的目标是利用商业 SPECT 系统采集的临床人体投影数据，编写代码进行图像重建，并评估图像质量。

**主要任务：**
1.  编写代码实现投影数据的重建。
2.  评估图像质量，并分析重建结果。

## 2. 系统与数据描述

### 2.1 成像系统
-   **设备**：可变角双探头 SPECT 系统。
-   **准直器**：平行孔准直器 (Parallel Hole Collimator)。
-   **采集方式**：
    -   双探头呈 "L" 型垂直分布。
    -   绕视野轴向以椭圆轨道逆时针旋转 90°。
    -   轮廓跟踪采集 (Body Contour)。

### 2.2 数据采集参数
-   **投影角度**：共 64 个角度 (每个探头 32 个角度)。
-   **角度间隔**：2.8125°。
-   **采集时间**：每个角度 20秒。
-   **轨道数据**：详见 `orbit.xlsx`。

### 2.3 探测器参数
-   **像素矩阵**：128 x 128。
-   **像素尺寸**：3.30 mm x 3.30 mm。
-   **固有分辨率**：3.7 mm (FWHM)。
-   **假设**：晶体无限薄，衰减系数无限大。

### 2.4 数据文件说明
-   **`Proj.dat`**：投影数据。
    -   格式：二进制, float32, Little Endian。
    -   维度：128 x 128 x 64 (第三维对应 64 个采集角度，顺序对应 `orbit.xlsx`)。
-   **`orbit.xlsx`**：采集轨道信息。
-   **`OSEMReconed.dat`**：参考重建结果 (float32, 128x128x128, 3.30mm 体素)。
-   **`Filtered.dat`**：高斯滤波后的参考结果 (参数：FWHM 10mm, 核 7x7x7)。

## 3. 详细任务要求

### 3.1 系统矩阵建模 (30分)
-   **重建视野 (FOV)**：离散化为 128 x 128 x 128 体素。
-   **体素尺寸**：3.30 mm x 3.30 mm x 3.30 mm。
-   **基础要求**：不建模准直器模糊，仅考虑几何投影。
-   **建议**：可将三维问题简化为二维切片重建，再堆叠成三维。
-   **加分项 (+20分)**：建模包含准直器模糊的系统矩阵 (高斯响应或频域/空域建模)。

### 3.2 图像重建 (35分)
-   **算法**：OSEM (Ordered Subsets Expectation Maximization)。
-   **要求**：选择合适的子集数和迭代次数。
-   **加分项 (+30分)**：MAP 重建 (基于二次平滑、稀疏先验等正则约束)。
-   **加速**：鼓励使用 GPU 或并行策略。

### 3.3 图像分析与评估 (25分)
1.  **指标计算 (10分)**：
    -   调研至少两个图像质量评估指标 (如 RMSE, SSIM, SNR 等)。
    -   说明指标含义和计算方法。
2.  **结果对比 (15分)**：
    -   计算重建图像的指标，并与 `OSEMReconed.dat` 对比。
    -   尝试不同后处理算法，并与 `Filtered.dat` 对比。

## 4. 提交要求
-   **报告**：Word 或 PDF 格式，包含建模方法、算法、结果、讨论。
-   **代码**：注释清晰，可复现结果。
-   **结果文件**：导入 Amide 软件并保存为 `.xif` 格式。
-   **打包**：压缩文件上传。

## 5. 工具建议
-   **Amide**：用于显示和整理结果 (路径不能含中文)。
-   **编程语言**：不限 (本项目已配置 Python 环境)。

## 6. 实施结果

### 6.1 重建参数
-   **算法**: OSEM (Ordered Subsets Expectation Maximization)
-   **子集数 (Subsets)**: 4
-   **迭代次数 (Iterations)**: 10
-   **系统矩阵**: 基于射线驱动的几何投影模型 (Geometric Projection)
-   **后处理**: 三维高斯滤波 (FWHM 10mm)

### 6.2 结果评估
将本项目的重建结果 (`MyRecon.dat`) 与参考结果 (`OSEMReconed.dat`) 进行对比：

| 指标 | MyRecon vs Reference | MyFiltered vs Filtered Ref |
| :--- | :--- | :--- |
| **RMSE** (均方根误差) | 0.209455 | 0.128543 |
| **SSIM** (结构相似性) | 0.537552 | 0.329922 |

**分析**:
- RMSE 较低，说明整体像素强度分布与参考结果接近。
- SSIM 约为 0.54，表明结构上存在一定差异，可能是由于系统矩阵建模的简化（未包含准直器模糊）或迭代次数/子集选取的细微差别导致。
- 滤波后的 RMSE 进一步降低，说明高斯滤波有效地抑制了噪声差异。

### 6.3 产出文件
-   **`MyRecon.dat`**: 原始重建结果 (128x128x128, float32)。
-   **`MyFiltered.dat`**: 滤波后结果 (128x128x128, float32)。
-   **`evaluation_results.txt`**: 详细评估指标记录。
